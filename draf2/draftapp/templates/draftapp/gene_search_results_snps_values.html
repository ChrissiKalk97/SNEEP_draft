{% extends "draftapp/base.html" %}
{% block body%}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" type= "text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
<script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script type = "text/javascript">
    $(document).ready(function(){
        $('#table').DataTable();
        lengthMenu: [
            [10, 25, 50, -1],
            [10, 25, 50, 'All'],
          ];
    });
    
  </script>
  {% if gene_dict %} 
     <h3>Gene query results:</h3> 
 <!-- Everything here does not make the code slow, it is actually the queries performed in the view...-->
   <table id = "table" class = "table table-bordered">
        <thead class = "alert-success">
            <tr>
              <th>Gene</th>
              <th>associated rSNP</th>
              <th>Gene Chromosome, Start, End</th>
              <th>GWAS traits associated to rSNPs</th>
              <th>Enhancers</th>
              <th>Transcription factors</th>
              
            </tr>
        </thead>
        <tbody>
          
          {% for gene, snps in gene_dict.items %}
            {% for snp in snps %}
            <tr>
              <td>{{gene}}, {{snp.enhancersxsnpsrsid__enhancerid__targetgene__genesymbol}}</td>
              <td><a href="{% url 'draftapp:snps_detail' snp.rsid %}">{{snp.rsid}}</a></td>
              <td>{{snp.enhancersxsnpsrsid__enhancerid__targetgene__chr}}, {{snp.enhancersxsnpsrsid__enhancerid__targetgene__start}}, {{snp.enhancersxsnpsrsid__enhancerid__targetgene__end}}</td>
              <td>{% for enhancer in snp.enhancersxsnpsrsid__enhancerid__enhancerid %}
                {% if exs == snp.enhancersxsnpsrsid.last and snp.enhancersxsnpsrsid__enhancerid__targetgene == gene%} 
                  {{enhancer}}
                {% else %} 
                  {{enhancer}}, 
                {% endif %}
              {% endfor %}
            </td>
              
              <!--<td>{% for exs in snp.enhancersxsnpsrsid.all %}
                    {% if exs == snp.enhancersxsnpsrsid.last%} 
                      {{exs.efoid.efoid.name}}
                    {% else %} 
                      {{exs.efoid.efoid.name}}, 
                    {% endif %}
                  {% endfor %}
                </td>-->
                <td>{% for exs in snp.enhancersxsnpsrsid.all %}
                      {% if exs == snp.enhancersxsnpsrsid.last%} 
                        {{exs.enhancerid.enhancerid}}
                      {% else %} 
                        {{exs.enhancerid.enhancerid}}, 
                      {% endif %}
                    {% endfor %}
                  </td>
              <td>{% for tfsXsnp in snp.Tfsxsnps_rsId.all %}
                    {% if tfsXsnp == snp.Tfsxsnps_rsId.last%} 
                      {{tfsXsnp.tfid.name}}
                    {% else %} 
                      {{tfsXsnp.tfid.name}}, 
                    {% endif %}
                  {% endfor %}
              </td>
            </tr>
               
            {% endfor %}
          {% endfor %}
        </tbody>
    </table>
  


 <!--   {% for gene, exgs in gene_dict.items %}
{{exgs}}
{{gene.genesymbol}}
  {% for exgs in exgs.values %}
  {{ exg }}
    {% for exs in exg.efoid.Enhancersxsnps_efoId.all %}
      {% for tfsxsnp in exg.efoid.Tfsxsnps_efoId.all %}
  <tr>
    <td>{{ gene.genesymbol }}</td>
   <td><a href="{% url 'draftapp:snps_detail' tfsxsnp.rsid.rsid %}">{{exs.rsid.rsid}}</a></td>
    <td>{{exs.rsid.chr}}</td>
    <td>{{exs.rsid.start}}</td>
    <td>{{exs.rsid.end}}</td>
    <td>{{exg.efoid.efoid.name}} </td>
    <td>{{tfsxsnp.tfid.name}}</td>
    

  </tr>
       {% endfor %}
    {% endfor %}
  {% endfor %}
{% endfor %}

  
</tbody>
</table>-->

  {% else %}
      <h3>This Gene is not investigated by us!</h3>
  {% endif %}
  

{% endblock %}

