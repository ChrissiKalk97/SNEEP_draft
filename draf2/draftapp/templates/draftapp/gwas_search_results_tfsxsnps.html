{% extends "draftapp/base.html" %}
{% block body%}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" type= "text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
<script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>



<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>


  <script type = "text/javascript">
    $(document).ready(function(){
        $('#table').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    });//{
          //"serverSide": true,
          //ajax: {
        //url: "{% url 'draftapp:Gwas_search_results_tfsxsnps' %}",
    //}
        //});
        lengthMenu: [
            [10, 25, 50, -1],
            [10, 25, 50, 'All'],
          ];
    });
  </script>
 {% if  snps_unique and gwas %} <!--and enhnacerxsnps, because don't necessarily exist, tfsxsnps and maybe these don't necessarily either...-->
    <h3>rSNPs results for GWAS query:</h3> 
      
   <table id = "table" class = "table table-bordered">
        <thead class = "alert-success">
            <tr>
              <th>GWAS trait</th>
              <th>rSNP</th>
              <th>Chromosome:Start-End</th>
              <th>TF</th>
              <th>Gene</th>
              <th>Ensembl id</th>
              <th>Enhancers</th>
            </tr>
        </thead>
        <tbody>
          
            {% for snp in snps_unique%}
            
              <tr>
                <td>{{gwas}}</td>
                <td><a href="{% url 'draftapp:snps_detail' snp.rsid %}">{{snp.rsid}} </a></td>
                <td>{{snp.chr}}:{{snp.start}}-{{snp.end}}</td>
                <td>{% if snp.Tfsxsnps_rsId.all%}
                      {% for tfsxsnp in snp.Tfsxsnps_rsId.all%}
                        {% if tfsxsnp == snp.Tfsxsnps_rsId.last and tfsxsnp in tfsxsnps%}
                          {{tfsxsnp.tfid.name}}
                        {% elif tfsxsnp in tfsxsnps%}
                          {{tfsxsnp.tfid.name}}, 
                        {% endif %}
                      {% endfor %}
                    {% else %}
                      Unknown
                    {% endif %} 
                </td>
                <td>{% if snp.enhancersxsnpsrsid.all%}
                  {% for exs in snp.enhancersxsnpsrsid.all%}
                    {% if exs == snp.enhancersxsnpsrsid.last%}
                      {{exs.enhancerid.targetgene.genesymbol}}
                    {% else %}
                      {{exs.enhancerid.targetgene.genesymbol}}, 
                      {% endif %}
                  {% endfor %}
                {% else %}
                  Unknown
                {% endif %}
                  </td>

                  <td>{% if snp.enhancersxsnpsrsid.all%}
                    {% for exs in snp.enhancersxsnpsrsid.all%}
                      {% if exs == snp.enhancersxsnpsrsid.last%}
                        {{exs.enhancerid.targetgene.geneid}}
                      {% else %}
                        {{exs.enhancerid.targetgene.geneid}}, 
                        {% endif %}
                    {% endfor %}
                  {% else %}
                    Unknown
                  {% endif %}
                    </td>


                  
                  <td>{% if snp.enhancersxsnpsrsid.all%}
                    {% for exs in snp.enhancersxsnpsrsid.all%}
                      {% if exs == snp.enhancersxsnpsrsid.last%}
                        {{exs.enhancerid.enhancerid}}
                      {% else %}
                        {{exs.enhancerid.enhancerid}}, 
                        {% endif %}
                    {% endfor %}
                  {% else %}
                    Unknown
                  {% endif %}
                    </td>
              </tr>
              
            {% endfor %}
        </tbody>
    </table>
  {% else %}
      <h3>This GWAS is not investigated by us!</h3>
  {% endif %}
  

{% endblock %}

